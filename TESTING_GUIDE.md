# Инструкция по тестированию CSG функциональности

## Запуск приложения

```bash
npm install  # Установить зависимости (три-bvh-csg уже добавлен)
npm run dev  # Запустить dev сервер
```

Приложение доступно по адресу: **http://localhost:5174/**

## Шаги для тестирования

### 1. Базовая функциональность (без 3D)

1. Добавьте несколько фрез на 2D канвас:
   - Откройте левую панель "Bits" (библиотеку фрез)
   - Перетащите фрезы на 2D канвас

2. Проверьте кнопку "Bits":
   - Клик по кнопке "Bits" (иконка фреза)
   - Фрезы на 2D канвасе должны скрываться/показываться
   - Кнопка должна менять визуальное состояние (bits-visible ↔ bits-hidden)

3. Проверьте кнопку "Part":
   - Клик по кнопке "Part" (иконка материала)
   - Должен появиться пунктирный контур вычтенного материала
   - Панель должна скрываться (видна только часть)
   - Кнопка должна менять состояние (part-visible ↔ part-hidden)

### 2. 3D функциональность

1. Переключитесь в 3D вид:
   - Нажмите кнопку "3D" (или "Both" для наглядности)
   - Панель должна появиться в 3D

2. Проверьте видимость фрез в 3D:
   - Кнопка "Bits" должна скрывать/показывать 3D меши фрез
   - Работает синхронно с 2D представлением

3. Проверьте CSG операцию:
   - Нажмите кнопку "Part"
   - В 3D должен примениться CSG:
     - Вместо отдельных объектов (панель + фрезы) должен быть один меш с вычтенной геометрией
     - Панель должна выглядеть как материал с отверстиями/пазами от фрез
   - Нажмите еще раз:
     - CSG должен отменяться
     - Вернется отдельное отображение панели и фрез

### 3. Расширенное тестирование

#### 3.1 Видимость фрез + CSG
1. Активируйте "Part" (CSG включен)
2. Нажмите "Bits" (фрезы скрыты)
   - Ожидается: видна только результирующая панель (с отверстиями)
3. Нажмите "Bits" снова (фрезы показаны)
   - Ожидается: видна панель + фрезы поверх

#### 3.2 Изменение параметров панели
1. Активируйте 3D вид с CSG включенным
2. Измените размеры панели:
   - Измените Width/Height/Thickness в левой панели
   - 3D должен обновиться с новыми размерами
   - CSG операция должна переприменяться автоматически

#### 3.3 Добавление/удаление фрез
1. CSG активирован, видна результирующая панель
2. Добавьте еще фрезу:
   - Перетащите на 2D канвас
   - 3D должен обновиться
   - CSG переприменится с новой фрезой
3. Удалите фрезу:
   - Нажмите кнопку удаления в таблице
   - 3D обновится (CSG переприменится)

#### 3.4 Переключение между представлениями
1. 2D вид:
   - Активируйте "Part"
   - Видна часть материала
2. Переключитесь на 3D:
   - Должно быть видно 3D представление с CSG
3. Вернитесь на 2D:
   - Смещение контурных линий не должно быть (это была ошибка, исправлена в updateOffsetContours)

## Проверка консоли

Откройте DevTools (F12) и смотрите консоль на предмет ошибок:

### Ожидаемые логи:
```
ThreeModule: Updating panel {width: 400, height: 600, thickness: 19, bits: 2}
ThreeModule: Creating bit path extrusions 2
CSG operation applied successfully
```

### Ошибки (если есть):
- "CSG is not exported" - проблема с импортом (должна быть исправлена)
- "Error applying CSG operation" - CSG не смог выполнить операцию (fallback на отдельное отображение)

## Примеры проблем, которые могли быть

1. **Фрезы не обновляются при изменении профиля**
   - ✅ Исправлено: добавлен вызов `updateThreeView()` в `updateCanvasBitsForBitId()`

2. **Камера сбрасывается при каждом обновлении**
   - ✅ Исправлено: добавлена проверка `cameraFitted` флага

3. **Кнопки "Bits" и "Part" не влияют на 3D**
   - ✅ Исправлено: добавлены вызовы методов ThreeModule в `toggleBitsVisibility()` и `togglePartView()`

## Отладка

Если что-то не работает, проверьте:

1. **Открыта ли 3D сцена?**
   - Нужно быть в режиме "3D" или "Both"

2. **Есть ли фрезы на канвасе?**
   - Без фрез CSG ничего не будет вычитать

3. **Видны ли логи в консоли?**
   - Если нет логов "Updating panel" - updateThreeView() не вызывается

4. **Работает ли 2D часть?**
   - 3D синхронизируется с 2D, поэтому 2D должна работать корректно

## Производительность

Для больших моделей (10+ фрез) CSG операция может занимать время:
- Первое применение CSG: ~100-500ms
- Последующие обновления (если кэширование): ~10-50ms

Это нормально для CSG операций.
