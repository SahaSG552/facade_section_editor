# Facade Section Editor

Проект для создания поперечных сечений мебельных фасадов с использованием фрез и CNC операций.

## Архитектура проекта

Проект использует модульную архитектуру, разделенную на логические модули для улучшения поддерживаемости и расширяемости.

### Структура проекта

```
src/
├── app/                    # Основное приложение
│   └── main.js            # Инициализация модулей
├── bits/                   # Модуль управления фрезами
│   └── BitsModule.js      # Управление коллекцией фрез и их отображением
├── canvas/                 # Модуль управления канвасом
│   ├── CanvasManager.js   # Управление SVG канвасом, слоями, зумом
│   ├── CanvasModule.js    # Модульный интерфейс для CanvasManager
│   └── zoomUtils.js       # Утилиты для зума и позиционирования
├── core/                   # Ядро модульной системы
│   ├── app.js             # Основной класс приложения
│   ├── BaseModule.js      # Базовый класс для всех модулей
│   ├── dependencyContainer.js # Контейнер зависимостей
│   ├── eventBus.js        # Система событий между модулями
│   └── index.js           # Экспорт всех компонентов ядра
├── data/                   # Слой данных
│   ├── bitsStore.js       # Хранение и управление данными фрез
│   ├── defaultBits.js     # Стандартные фрезы
│   └── userBits.json      # Пользовательские фрезы
├── export/                 # Модули экспорта (будущий)
├── operations/             # Модули операций CNC (будущий)
├── panel/                  # UI панели
│   └── BitsManager.js     # Управление UI панелью фрез
├── ui/                     # UI компоненты (будущий)
├── utils/                  # Утилиты
│   ├── dxfExporter.js     # Экспорт в DXF формат
│   ├── makerProcessor.js  # Обработка геометрии
│   ├── offsetCalculator.js # Расчет смещений
│   └── utils.js           # Общие утилиты
├── OLD/                    # Архив неиспользуемых файлов
│   ├── controllers/       # Старые контроллеры
│   ├── models/            # Старые модели
│   ├── services/          # Старые сервисы
│   └── storage/           # Старое хранилище
└── script.js              # Основной файл приложения
```

## Описание модулей

### Core Module (`src/core/`)
**Назначение:** Предоставляет инфраструктуру для модульной архитектуры.

- **app.js**: Основной класс приложения, управляет жизненным циклом модулей
- **eventBus.js**: Система событий для коммуникации между модулями без прямых зависимостей
- **dependencyContainer.js**: Контейнер зависимостей для управления инстансами модулей
- **BaseModule.js**: Базовый класс, предоставляющий общую функциональность для всех модулей

### Canvas Module (`src/canvas/`)
**Назначение:** Управление SVG канвасом и его слоями.

- **CanvasManager.js**: Основной класс для управления SVG элементами, слоями, зумом, панорамированием и сеткой
- **CanvasModule.js**: Модульный интерфейс для CanvasManager, интегрируется с остальной системой
- **zoomUtils.js**: Утилиты для расчета зума, позиционирования элементов и преобразований координат

### Bits Module (`src/bits/`)
**Назначение:** Управление коллекцией фрез и их визуализацией.

- **BitsModule.js**: Модульный интерфейс для управления фрезами, интегрируется с CanvasManager

### Data Module (`src/data/`)
**Назначение:** Управление данными приложения.

- **bitsStore.js**: Хранение и управление данными фрез с поддержкой localStorage
- **defaultBits.js**: Стандартная коллекция фрез
- **userBits.json**: Пользовательские фрезы

### Operations Module (`src/operations/`) [Планируется]
**Назначение:** CNC операции и расчеты.

- Обработка различных типов операций (профилирование, V-резка, карманная обработка)
- Расчет траекторий инструментов
- Оптимизация последовательности операций

### Export Module (`src/export/`)
**Назначение:** Экспорт данных в различные форматы.

- **DXF экспорт**: Полнофункциональный экспорт геометрии в AutoCAD DXF формат
- **Расширяемость**: Готов к добавлению других форматов (SVG, G-code и т.д.)
- **Модульная архитектура**: Изолированная логика экспорта от основной функциональности

### UI Module (`src/ui/`)
**Назначение:** Управление пользовательским интерфейсом и состоянием UI.

- **Управление темами**: Светлая/темная тема с сохранением в localStorage
- **Управление панелями**: Адаптивные левая/правая панели с overlay для мобильных
- **Обновление canvas**: Синхронизация canvas при изменении UI
- **Логирование операций**: Запись операций пользователя
- **Диалоги**: Alert, confirm, file input

### Utils Module (`src/utils/`)
**Назначение:** Общие утилиты и специализированные функции.

- **dxfExporter.js**: Экспорт геометрии в DXF формат для CNC станков
- **makerProcessor.js**: Обработка и генерация геометрических форм с помощью Maker.js
- **offsetCalculator.js**: Расчет смещений для различных типов операций
- **utils.js**: Математические утилиты и вспомогательные функции

## Принципы архитектуры

### 1. Модульность
Каждый модуль отвечает за конкретную функциональную область и имеет четко определенный интерфейс.

### 2. Независимость
Модули общаются через EventBus, что позволяет изменять внутреннюю реализацию без влияния на другие модули.

### 3. Обратная совместимость
Новая модульная система работает параллельно со старым кодом, обеспечивая плавный переход.

### 4. Расширяемость
Легко добавлять новые модули и функциональность без изменения существующего кода.

## Жизненный цикл приложения

1. **Инициализация**: `initializeModularSystem()` запускает модульную систему
2. **Регистрация модулей**: В `src/app/main.js` регистрируются все модули
3. **Инициализация модулей**: Каждый модуль инициализируется в правильном порядке
4. **Запуск приложения**: Основная логика в `src/script.js` начинает работу
5. **Завершение**: При необходимости модули могут быть корректно завершены

## Как начать разработку

### Добавление нового модуля:
1. Создать папку в `src/`
2. Создать основной файл модуля, наследующий от `BaseModule`
3. Зарегистрировать модуль в `src/app/main.js`
4. Определить события для коммуникации с другими модулями

### Работа с существующим модулем:
1. Импортировать модуль через `app.getModule('moduleName')`
2. Использовать публичные методы модуля
3. Подписываться на события через `eventBus.on('eventName', callback)`

## Тестирование

Проект использует Vite для разработки. Запуск:
```bash
npm run dev
```

Приложение будет доступно по адресу: http://localhost:5173/

## Будущие планы

1. **Завершение модуляризации**: Перенести всю функциональность в модули
2. **Добавление тестов**: Unit и интеграционные тесты для модулей
3. **Документация**: Подробная документация API для каждого модуля
4. **Оптимизация**: Улучшение производительности и пользовательского опыта
